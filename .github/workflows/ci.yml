name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run ruff check src/ tests/
      - run: uv run ruff format --check src/ tests/

  test:
    runs-on: ubuntu-latest
    steps:
      - name: Free disk space
        run: |
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /opt/hostedtoolcache/CodeQL
          sudo docker image prune --all --force
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: |
          uv run pytest tests/ -v \
            --ignore=tests/test_semantic.py \
            --ignore=tests/test_integration.py \
            --ignore=tests/test_backend_integration.py \
            --ignore=tests/test_backend_e2e.py \
            --ignore=tests/test_feature_matrix_comprehensive.py \
            --ignore=tests/test_backend_user_journey.py \
            --ignore=tests/container/
